#version 430 core
layout (triangles) in;
layout (triangle_strip, max_vertices = 3) out;

in vec3 relativePosition[];
in vec3 toLightVector[][4];
in vec3 toCameraVector[];
in float visibility[];
in float shoreFactor[];

out vec3 normal;
out vec3 toLightVectorG[4];
out vec3 toCameraVectorG;
out float visibilityG;
out float shoreFactorG;

uniform vec3 lightPosition[4];

vec3 calcTriangleNormal(){
	vec3 tangent1 = relativePosition[1].xyz - relativePosition[0].xyz;
	vec3 tangent2 = relativePosition[2].xyz - relativePosition[0].xyz;
	vec3 normal = cross(tangent1, tangent2);
	return normalize(normal);
}

void main(void) {
	for(int i=0;i<3;i++){
   		gl_Position = gl_in[i].gl_Position;
   		normal = calcTriangleNormal();
   		
   		for (int j=0; j<3; j++) {
			toLightVectorG[j] = toLightVector[i][j];
		}
		
		toCameraVectorG = toCameraVector[i];
		visibilityG = visibility[i];
		shoreFactorG = shoreFactor[i];
		
   		
   		EmitVertex();
   	}
   	
   	EndPrimitive();
}